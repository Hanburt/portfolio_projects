--utilizing BigQuery--

--view dataset--
SELECT *
FROM `dotted-repeater-387021.covid_data.covid_deaths` 
LIMIT 100;

--select data to be used--
SELECT location, date, total_cases, new_cases, total_deaths,population
FROM `dotted-repeater-387021.covid_data.covid_deaths` 
ORDER BY 1, 2;

--total cases vs total deaths--
SELECT location, date, total_cases, total_deaths, (total_deaths/total_cases)*100 AS death_percentage 
FROM `dotted-repeater-387021.covid_data.covid_deaths` 
ORDER BY 1, 2;

--total cases vs total deaths in US--
SELECT location, date, total_cases, total_deaths, (total_deaths/total_cases)*100 AS death_percentage 
FROM `dotted-repeater-387021.covid_data.covid_deaths`
WHERE location = 'United States'
ORDER BY date;

--total cases vs population--
SELECT location, date, total_cases, population, (total_cases/population)*100 AS cases_percentage 
FROM `dotted-repeater-387021.covid_data.covid_deaths`
WHERE location = 'United States'
ORDER BY date;

--countries with highest infection rate based on population--
SELECT location, population, MAX(total_cases) AS highest_infection_count, MAX((total_cases/population))*100 AS percent_population_infected
FROM `dotted-repeater-387021.covid_data.covid_deaths`
GROUP BY location, population
ORDER BY percent_population_infected DESC;

--countries with highest death count by population--
SELECT location, MAX(total_deaths) AS total_death_count, 
FROM `dotted-repeater-387021.covid_data.covid_deaths`
WHERE continent is not null
GROUP BY location
ORDER BY total_death_count DESC;

--death count by continent--
SELECT location, MAX(total_deaths) AS total_death_count, 
FROM `dotted-repeater-387021.covid_data.covid_deaths`
WHERE continent is null
GROUP BY location
ORDER BY total_death_count DESC;

--global numbers--

SELECT date, SUM(new_cases) AS total_cases, SUM(new_deaths) AS total_deaths, SUM(new_deaths)/SUM(new_cases)*100 AS death_percentage
FROM `dotted-repeater-387021.covid_data.covid_deaths` 
WHERE continent is not null
GROUP BY date
ORDER BY 1, 2;

--global totals--
SELECT SUM(new_cases) AS total_cases, SUM(new_deaths) AS total_deaths, SUM(new_deaths)/SUM(new_cases)*100 AS death_percentage
FROM `dotted-repeater-387021.covid_data.covid_deaths` 
WHERE continent is not null;

--view 2nd dataset--
SELECT *
FROM `dotted-repeater-387021.covid_data.covid_vaccinations` 
LIMIT 100

--join tables--
SELECT *
FROM `dotted-repeater-387021.covid_data.covid_deaths` AS deaths
JOIN `dotted-repeater-387021.covid_data.covid_vaccinations` AS vaccinations
  ON deaths.location = vaccinations.location
  AND deaths.date = vaccinations.date
  
  --total population vs vaccinations per day--

SELECT deaths.continent, deaths.location, deaths.date, deaths.population, vaccinations.new_vaccinations
FROM `dotted-repeater-387021.covid_data.covid_deaths` AS deaths
JOIN `dotted-repeater-387021.covid_data.covid_vaccinations` AS vaccinations
  ON deaths.location = vaccinations.location
  AND deaths.date = vaccinations.date
WHERE deaths.continent is not null
ORDER BY 2, 3

--rolling count of new vaccines by country--
SELECT deaths.continent, deaths.location, deaths.date, deaths.population, vaccinations.new_vaccinations, SUM(vaccinations.new_vaccinations) OVER (PARTITION BY deaths.location ORDER BY deaths.location, deaths.date) AS rolling_vaccination_total 
FROM `dotted-repeater-387021.covid_data.covid_deaths` AS deaths
JOIN `dotted-repeater-387021.covid_data.covid_vaccinations` AS vaccinations
  ON deaths.location = vaccinations.location
  AND deaths.date = vaccinations.date
WHERE deaths.continent is not null
ORDER BY 2, 3
